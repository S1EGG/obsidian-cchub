# Obsidian CCHub æ’ä»¶ - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

> **ç‰ˆæœ¬**: 1.0.0
> **æœ€åæ›´æ–°**: 2026-01-04
> **çŠ¶æ€**: è‰æ¡ˆ

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

éšç€ AI ç¼–ç åŠ©æ‰‹ï¼ˆå¦‚ Claude Codeã€Gemini CLIã€Codex CLIï¼‰çš„æ™®åŠï¼Œç”¨æˆ·å¸Œæœ›èƒ½å¤Ÿåœ¨ Obsidian ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›å¼ºå¤§çš„ CLI å·¥å…·æ¥ç¼–è¾‘å’Œç®¡ç†æ–‡æ¡£åº“ã€‚å½“å‰è¿™äº›å·¥å…·ä¸»è¦é€šè¿‡å‘½ä»¤è¡Œäº¤äº’ï¼Œç¼ºä¹å‹å¥½çš„å›¾å½¢ç•Œé¢ï¼Œæœ¬é¡¹ç›®æ—¨åœ¨å°†è¿™äº› CLI Agent å·¥å…·å°è£…è¿›ä¸€ä¸ªä¼˜é›…çš„ Chat ç•Œé¢ï¼Œæä¾›è‰¯å¥½çš„äº¤äº’ä½“éªŒã€‚

### 1.2 é¡¹ç›®ç›®æ ‡

1. **ç»Ÿä¸€å…¥å£**: å°† Claude Codeã€Gemini CLIã€Codex CLI ç­‰å¤šç§ CLI Agent é›†æˆåˆ° Obsidian çš„ç»Ÿä¸€ Chat ç•Œé¢
2. **æ— ç¼äº¤äº’**: æä¾›æµç•…çš„å¯¹è¯å¼äº¤äº’ä½“éªŒï¼Œè®©ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€ä¸ Agent åä½œç¼–è¾‘æ–‡æ¡£
3. **å¯æ‰©å±•æ€§**: æ”¯æŒè‡ªå®šä¹‰ Agent å’Œ ACP (Agent Client Protocol) å…¼å®¹çš„ç¬¬ä¸‰æ–¹å·¥å…·
4. **è§†è§‰ä¼˜ç§€**: å€Ÿé‰´ obsidian-copilot çš„ UI/UX è®¾è®¡ï¼Œæä¾›ç°ä»£åŒ–ã€ç¾è§‚çš„ç•Œé¢

### 1.3 å‚è€ƒé¡¹ç›®

| é¡¹ç›® | å‚è€ƒå†…å®¹ |
|------|----------|
| [obsidian-agent-client](https://github.com/RAIT-09/obsidian-agent-client) | CLI å·¥å…·é›†æˆæ–¹å¼ã€ACP åè®®å®ç°ã€æ¶ˆæ¯ç±»å‹å®šä¹‰ã€æƒé™å¤„ç†æœºåˆ¶ |
| [obsidian-copilot](https://github.com/logancyang/obsidian-copilot) | äº¤äº’ä½“éªŒè®¾è®¡ã€è§†è§‰è®¾è®¡ã€æ¶ˆæ¯æ¸²æŸ“ã€ä¸Šä¸‹æ–‡ç®¡ç† |

---

## 2. æ ¸å¿ƒåŠŸèƒ½

### 2.1 Agent é›†æˆ

#### 2.1.1 æ”¯æŒçš„ Agent ç±»å‹

| Agent | åŒ…å | æè¿° |
|-------|------|------|
| **Claude Code** | `@zed-industries/claude-code-acp` | Anthropic Claude é©±åŠ¨çš„ç¼–ç åŠ©æ‰‹ |
| **Gemini CLI** | `@google/gemini-cli` | Google Gemini é©±åŠ¨çš„ CLI å·¥å…· |
| **Codex CLI** | `@zed-industries/codex-acp` | OpenAI Codex é©±åŠ¨çš„ç¼–ç åŠ©æ‰‹ |
| **è‡ªå®šä¹‰ Agent** | ç”¨æˆ·é…ç½® | æ”¯æŒä»»ä½• ACP å…¼å®¹çš„ Agent |

#### 2.1.2 Agent é…ç½®

```typescript
interface AgentConfig {
  id: string;                        // å”¯ä¸€æ ‡è¯†ç¬¦ (e.g., "claude", "gemini")
  displayName: string;               // æ˜¾ç¤ºåç§°
  command: string;                   // å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
  args: string[];                    // å‘½ä»¤è¡Œå‚æ•°
  env?: Record<string, string>;      // ç¯å¢ƒå˜é‡ (å« API Key)
  workingDirectory: string;          // å·¥ä½œç›®å½•
}
```

### 2.2 Chat ç•Œé¢åŠŸèƒ½

#### 2.2.1 æ¶ˆæ¯ç±»å‹

åŸºäº obsidian-agent-client çš„åŸŸæ¨¡å‹å®šä¹‰ï¼š

```typescript
type MessageContent =
  | { type: "text"; text: string }                    // æ™®é€šæ–‡æœ¬
  | { type: "text_with_context"; text: string; ... }  // å¸¦ä¸Šä¸‹æ–‡çš„æ–‡æœ¬
  | { type: "agent_thought"; text: string }           // Agent æ€è€ƒè¿‡ç¨‹
  | { type: "image"; data: string; mimeType: string } // å›¾ç‰‡
  | { type: "tool_call"; toolCallId: string; ... }    // å·¥å…·è°ƒç”¨
  | { type: "plan"; entries: PlanEntry[] }            // æ‰§è¡Œè®¡åˆ’
  | { type: "permission_request"; ... }               // æƒé™è¯·æ±‚
  | { type: "terminal"; terminalId: string };         // ç»ˆç«¯è¾“å‡º
```

#### 2.2.2 å·¥å…·è°ƒç”¨ (Tool Call)

| å·¥å…·ç±»å‹ (Kind) | æè¿° | å›¾æ ‡å»ºè®® |
|-----------------|------|----------|
| `read` | è¯»å–æ–‡ä»¶æˆ–æ•°æ® | ğŸ“– |
| `edit` | ä¿®æ”¹ç°æœ‰å†…å®¹ | âœï¸ |
| `delete` | åˆ é™¤æ–‡ä»¶æˆ–æ•°æ® | ğŸ—‘ï¸ |
| `move` | ç§»åŠ¨æˆ–é‡å‘½å | ğŸ“¦ |
| `search` | æœç´¢å†…å®¹ | ğŸ” |
| `execute` | æ‰§è¡Œå‘½ä»¤æˆ–è„šæœ¬ | âš¡ |
| `think` | Agent æ¨ç†/è§„åˆ’ | ğŸ’­ |
| `fetch` | è·å–å¤–éƒ¨èµ„æº | ğŸŒ |

#### 2.2.3 æƒé™ç®¡ç†

```typescript
interface PermissionOption {
  optionId: string;
  name: string;
  kind: "allow_once" | "allow_always" | "reject_once" | "reject_always";
}
```

**æƒé™è¯·æ±‚æµç¨‹**:
1. Agent å‘èµ·å·¥å…·è°ƒç”¨è¯·æ±‚
2. æ’ä»¶æ£€æŸ¥æ˜¯å¦éœ€è¦ç”¨æˆ·æˆæƒ
3. æ˜¾ç¤ºæƒé™è¯·æ±‚ UIï¼ˆåŒ…å«æ“ä½œè¯¦æƒ…å’Œé€‰é¡¹ï¼‰
4. ç”¨æˆ·é€‰æ‹©åï¼Œå°†å†³å®šå‘é€å› Agent
5. Agent ç»§ç»­æ‰§è¡Œæˆ–ä¸­æ­¢æ“ä½œ

### 2.3 ä¸Šä¸‹æ–‡åŠŸèƒ½

#### 2.3.1 ç¬”è®°å¼•ç”¨ (@mention)

- **è¯­æ³•**: `@[[ç¬”è®°åç§°]]` æˆ– `@ç¬”è®°åç§°`
- **è‡ªåŠ¨è¡¥å…¨**: è¾“å…¥ `@` æ—¶æ˜¾ç¤ºç¬”è®°å»ºè®®ä¸‹æ‹‰æ¡†
- **æ¨¡ç³Šæœç´¢**: æ”¯æŒæŒ‰æ–‡ä»¶åã€è·¯å¾„ã€åˆ«åæœç´¢
- **è‡ªåŠ¨å¼•ç”¨**: å¯é…ç½®è‡ªåŠ¨å°†å½“å‰æ´»åŠ¨ç¬”è®°æ·»åŠ åˆ°ä¸Šä¸‹æ–‡

#### 2.3.2 Slash å‘½ä»¤

- **è¯­æ³•**: `/å‘½ä»¤å [å‚æ•°]`
- **åŠ¨æ€å‘½ä»¤**: ä» Agent è·å–å¯ç”¨å‘½ä»¤åˆ—è¡¨
- **å‘½ä»¤ç¤ºä¾‹**: `/web`, `/test`, `/plan` ç­‰

### 2.4 ä¼šè¯ç®¡ç†

#### 2.4.1 ä¼šè¯çŠ¶æ€

```typescript
type SessionState =
  | "initializing"    // è¿æ¥å»ºç«‹ä¸­
  | "authenticating"  // è®¤è¯ä¸­
  | "ready"           // å°±ç»ª
  | "busy"            // å¤„ç†ä¸­
  | "error"           // é”™è¯¯
  | "disconnected";   // å·²æ–­å¼€
```

#### 2.4.2 ä¼šè¯åŠŸèƒ½

- **æ–°å»ºä¼šè¯**: å¼€å§‹æ–°çš„å¯¹è¯
- **åˆ‡æ¢ Agent**: åœ¨ä¸åŒ Agent é—´åˆ‡æ¢
- **å¯¼å‡ºå¯¹è¯**: å°†å¯¹è¯å¯¼å‡ºä¸º Markdown
- **å†å²è®°å½•**: æµè§ˆå’Œæ¢å¤å†å²ä¼šè¯

---

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æ•´ä½“æ¶æ„

é‡‡ç”¨ **React Hooks æ¶æ„**ï¼Œå‚è€ƒ obsidian-agent-client çš„è®¾è®¡ï¼š

```
src/
â”œâ”€â”€ domain/                   # çº¯åŸŸæ¨¡å‹ + ç«¯å£æ¥å£
â”‚   â”œâ”€â”€ models/               # agent-config, chat-message, chat-session ç­‰
â”‚   â””â”€â”€ ports/                # IAgentClient, ISettingsAccess, IVaultAccess
â”œâ”€â”€ adapters/                 # æ¥å£å®ç°
â”‚   â”œâ”€â”€ acp/                  # ACP åè®®é€‚é…å™¨
â”‚   â””â”€â”€ obsidian/             # Obsidian å¹³å°é€‚é…å™¨
â”œâ”€â”€ hooks/                    # React è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ useAgentSession.ts    # ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”œâ”€â”€ useChat.ts            # æ¶ˆæ¯å‘é€å’Œå›è°ƒ
â”‚   â”œâ”€â”€ usePermission.ts      # æƒé™å¤„ç†
â”‚   â”œâ”€â”€ useMentions.ts        # @[[ç¬”è®°]] å»ºè®®
â”‚   â”œâ”€â”€ useSlashCommands.ts   # /å‘½ä»¤ å»ºè®®
â”‚   â””â”€â”€ useSettings.ts        # è®¾ç½®è®¢é˜…
â”œâ”€â”€ components/               # UI ç»„ä»¶
â”‚   â”œâ”€â”€ chat/                 # Chat ç›¸å…³ç»„ä»¶
â”‚   â””â”€â”€ settings/             # è®¾ç½®é¡µé¢
â”œâ”€â”€ shared/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ message-service.ts    # æ¶ˆæ¯å¤„ç†çº¯å‡½æ•°
â”‚   â”œâ”€â”€ terminal-manager.ts   # è¿›ç¨‹ç®¡ç†
â”‚   â””â”€â”€ logger.ts             # æ—¥å¿—å·¥å…·
â”œâ”€â”€ plugin.ts                 # Obsidian æ’ä»¶å…¥å£
â””â”€â”€ main.ts                   # å¯¼å‡ºå…¥å£
```

### 3.2 æ ¸å¿ƒæ¥å£

#### 3.2.1 IAgentClient (Agent é€šä¿¡æ¥å£)

```typescript
interface IAgentClient {
  // ç”Ÿå‘½å‘¨æœŸ
  initialize(config: AgentConfig): Promise<InitializeResult>;
  newSession(workingDirectory: string): Promise<NewSessionResult>;
  authenticate(methodId: string): Promise<boolean>;
  disconnect(): Promise<void>;

  // æ¶ˆæ¯äº¤äº’
  sendPrompt(sessionId: string, content: PromptContent[]): Promise<void>;
  cancel(sessionId: string): Promise<void>;

  // å›è°ƒæ³¨å†Œ
  onSessionUpdate(callback: (update: SessionUpdate) => void): void;
  onError(callback: (error: AgentError) => void): void;

  // æƒé™å¤„ç†
  respondToPermission(requestId: string, optionId: string): Promise<void>;

  // çŠ¶æ€æŸ¥è¯¢
  isInitialized(): boolean;
  getCurrentAgentId(): string | null;

  // æ¨¡å¼å’Œæ¨¡å‹
  setSessionMode(sessionId: string, modeId: string): Promise<void>;
  setSessionModel(sessionId: string, modelId: string): Promise<void>;
}
```

#### 3.2.2 IVaultAccess (Vault è®¿é—®æ¥å£)

```typescript
interface IVaultAccess {
  readNote(path: string): Promise<string>;
  searchNotes(query: string): Promise<NoteMetadata[]>;
  getActiveNote(): Promise<NoteMetadata | null>;
  listNotes(): Promise<NoteMetadata[]>;
}
```

### 3.3 ACP åè®®é€šä¿¡

**é€šä¿¡æ–¹å¼**: JSON-RPC 2.0 over stdin/stdout

**æ ¸å¿ƒæ–¹æ³•**:
- `initialize`: åˆå§‹åŒ– Agent è¿æ¥
- `newSession`: åˆ›å»ºæ–°ä¼šè¯
- `authenticate`: è®¤è¯
- `prompt`: å‘é€æ¶ˆæ¯
- `cancel`: å–æ¶ˆæ“ä½œ

**é€šçŸ¥ç±»å‹ (session/update)**:
- `agent_message_chunk`: æ–‡æœ¬å“åº”ç‰‡æ®µ
- `agent_thought_chunk`: æ€è€ƒè¿‡ç¨‹ç‰‡æ®µ
- `tool_call`: æ–°å·¥å…·è°ƒç”¨
- `tool_call_update`: å·¥å…·è°ƒç”¨çŠ¶æ€æ›´æ–°
- `plan`: æ‰§è¡Œè®¡åˆ’
- `available_commands_update`: Slash å‘½ä»¤æ›´æ–°
- `current_mode_update`: æ¨¡å¼å˜æ›´

---

## 4. UI/UX è®¾è®¡è§„èŒƒ

### 4.1 æ•´ä½“å¸ƒå±€

å‚è€ƒ obsidian-copilot çš„è®¾è®¡è¯­è¨€ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Agent Name â–¼    [New Chat] [Export] [âš™ï¸]   â”‚ â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ§‘ User Message                          â”‚  â”‚
â”‚  â”‚ å¸¦æœ‰ä¸Šä¸‹æ–‡ Badge: @[[Note1]] @[[Note2]]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– Agent Response                        â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ’­ Thinking... (å¯æŠ˜å )        â”‚       â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ“ Tool Call: Edit file.md     â”‚       â”‚  â”‚ â† å·¥å…·è°ƒç”¨ Banner
â”‚  â”‚ â”‚ Status: âœ” Completed            â”‚       â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚ This is the response text...             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚ â† Messages Area
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âš ï¸ Permission Request                    â”‚  â”‚
â”‚  â”‚ Agent wants to modify: config.ts         â”‚  â”‚
â”‚  â”‚ [Allow Once] [Allow Always] [Reject]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mode: [Build â–¼]    Model: [Sonnet â–¼]          â”‚ â† Controls
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ @[[note]] suggestion dropdown            â”‚  â”‚ â† Suggestion Dropdown
â”‚  â”‚ > Note 1                                  â”‚  â”‚
â”‚  â”‚   Note 2                                  â”‚  â”‚
â”‚  â”‚   Note 3                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Type your message...           [ğŸ“] [â†‘]  â”‚  â”‚ â† Input Area
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç»„ä»¶è®¾è®¡

#### 4.2.1 æ¶ˆæ¯ç»„ä»¶

| æ¶ˆæ¯ç±»å‹ | æ ·å¼ç‰¹ç‚¹ |
|----------|----------|
| ç”¨æˆ·æ¶ˆæ¯ | å³å¯¹é½ï¼Œå¸¦è¾¹æ¡†ï¼Œè½»å¾®èƒŒæ™¯è‰² |
| Agent æ¶ˆæ¯ | å·¦å¯¹é½ï¼Œæ— è¾¹æ¡† |
| æ€è€ƒè¿‡ç¨‹ | å¯æŠ˜å åŒºåŸŸï¼Œç°è‰²æ–‡å­— |
| å·¥å…·è°ƒç”¨ | Banner æ ·å¼ï¼Œå¸¦çŠ¶æ€æŒ‡ç¤ºå™¨ |
| æƒé™è¯·æ±‚ | é†’ç›®å¡ç‰‡ï¼Œå¸¦æ“ä½œæŒ‰é’® |
| ç»ˆç«¯è¾“å‡º | ç­‰å®½å­—ä½“ï¼Œæ·±è‰²èƒŒæ™¯ |

#### 4.2.2 ä¸Šä¸‹æ–‡ Badge

å‚è€ƒ obsidian-copilot çš„ ContextBadges è®¾è®¡ï¼š

```typescript
// æ”¯æŒçš„ä¸Šä¸‹æ–‡ç±»å‹
- ContextNoteBadge      // ğŸ“„ ç¬”è®°å¼•ç”¨
- ContextUrlBadge       // ğŸ”— URL å¼•ç”¨
- ContextTagBadge       // ğŸ·ï¸ æ ‡ç­¾
- ContextFolderBadge    // ğŸ“ æ–‡ä»¶å¤¹
- ContextSelectedTextBadge // âœ‚ï¸ é€‰ä¸­æ–‡æœ¬
```

#### 4.2.3 å·¥å…·è°ƒç”¨ Banner

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Edit file: src/main.ts                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ - old line                              â”‚ â”‚ â† Diff æ˜¾ç¤º
â”‚ â”‚ + new line                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ Status: âœ” Completed                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 äº¤äº’è®¾è®¡

#### 4.3.1 æ¶ˆæ¯è¾“å…¥

- **å¤šè¡Œè¾“å…¥**: æ”¯æŒ Shift+Enter æ¢è¡Œ
- **å¿«æ·å‘é€**: Enter ç›´æ¥å‘é€
- **å›¾ç‰‡ç²˜è´´**: æ”¯æŒç²˜è´´/æ‹–æ”¾å›¾ç‰‡
- **è‡ªåŠ¨è¡¥å…¨**: @ è§¦å‘ç¬”è®°å»ºè®®ï¼Œ/ è§¦å‘å‘½ä»¤å»ºè®®

#### 4.3.2 æ¶ˆæ¯æ“ä½œ

| æ“ä½œ | å¿«æ·é”® | æè¿° |
|------|--------|------|
| å¤åˆ¶ | - | å¤åˆ¶æ¶ˆæ¯å†…å®¹ |
| é‡æ–°ç”Ÿæˆ | - | é‡æ–°ç”Ÿæˆ Agent å“åº” |
| ç¼–è¾‘ | - | ç¼–è¾‘ç”¨æˆ·æ¶ˆæ¯å¹¶é‡æ–°å‘é€ |
| åˆ é™¤ | - | åˆ é™¤æ¶ˆæ¯ |
| æ’å…¥åˆ°ç¼–è¾‘å™¨ | - | å°†å†…å®¹æ’å…¥å½“å‰ç¬”è®° |

#### 4.3.3 çŠ¶æ€æŒ‡ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ Ready                                  â”‚ â† å°±ç»ªçŠ¶æ€
â”‚ ğŸŸ¡ Thinking...                            â”‚ â† å¤„ç†ä¸­
â”‚ ğŸ”´ Error: Connection failed               â”‚ â† é”™è¯¯çŠ¶æ€
â”‚ âšª Disconnected                           â”‚ â† æ–­å¼€è¿æ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. è®¾ç½®é…ç½®

### 5.1 åŸºç¡€è®¾ç½®

| è®¾ç½®é¡¹ | ç±»å‹ | æè¿° |
|--------|------|------|
| `activeAgent` | string | å½“å‰æ¿€æ´»çš„ Agent ID |
| `nodePath` | string | Node.js å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ |

### 5.2 Agent è®¾ç½®

#### 5.2.1 å†…ç½® Agent é…ç½®

```typescript
interface BuiltInAgentSettings {
  // Claude Code
  claudeCode: {
    enabled: boolean;
    path: string;        // å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
    apiKey?: string;     // API Key (å¯é€‰ï¼Œå·²ç™»å½•åˆ™ä¸éœ€è¦)
  };

  // Gemini CLI
  geminiCli: {
    enabled: boolean;
    path: string;
    apiKey?: string;
  };

  // Codex CLI
  codexCli: {
    enabled: boolean;
    path: string;
    apiKey?: string;
  };
}
```

#### 5.2.2 è‡ªå®šä¹‰ Agent é…ç½®

```typescript
interface CustomAgentConfig {
  id: string;
  displayName: string;
  command: string;
  args: string[];
  envVars: Array<{ key: string; value: string }>;
}
```

### 5.3 è¡Œä¸ºè®¾ç½®

| è®¾ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|--------|------|--------|------|
| `autoMentionActiveNote` | boolean | true | è‡ªåŠ¨å¼•ç”¨å½“å‰æ´»åŠ¨ç¬”è®° |
| `autoExportOnNewChat` | boolean | false | æ–°å»ºä¼šè¯æ—¶è‡ªåŠ¨å¯¼å‡ºä¸Šä¸€ä¸ªä¼šè¯ |
| `debugMode` | boolean | false | å¯ç”¨è°ƒè¯•æ—¥å¿— |
| `workingDirectory` | string | Vault æ ¹ç›®å½• | Agent å·¥ä½œç›®å½• |

### 5.4 æƒé™è®¾ç½®

| è®¾ç½®é¡¹ | ç±»å‹ | æè¿° |
|--------|------|------|
| `autoApproveRead` | boolean | è‡ªåŠ¨æ‰¹å‡†è¯»å–æ“ä½œ |
| `autoApproveList` | boolean | è‡ªåŠ¨æ‰¹å‡†åˆ—è¡¨æ“ä½œ |
| `autoApproveExecute` | boolean | è‡ªåŠ¨æ‰¹å‡†æ‰§è¡Œæ“ä½œ |

---

## 6. å®ç°è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„ (MVP)

**ç›®æ ‡**: å®ç°åŸºæœ¬çš„ Chat ç•Œé¢å’Œå•ä¸€ Agent (Claude Code) çš„é›†æˆ

#### 6.1.1 æ ¸å¿ƒåŸºç¡€è®¾æ–½

- [ ] é¡¹ç›®åˆå§‹åŒ– (esbuild, TypeScript, React)
- [ ] åŸŸæ¨¡å‹å®šä¹‰ (ChatMessage, ChatSession, AgentConfig)
- [ ] ç«¯å£æ¥å£å®šä¹‰ (IAgentClient, IVaultAccess, ISettingsAccess)
- [ ] æ’ä»¶å…¥å£å’Œè®¾ç½®é¡µé¢éª¨æ¶

#### 6.1.2 ACP é€‚é…å™¨

- [ ] è¿›ç¨‹ç®¡ç† (spawn, ç›‘æ§, ç»ˆæ­¢)
- [ ] JSON-RPC é€šä¿¡å®ç°
- [ ] ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] æ¶ˆæ¯æµå¤„ç† (ndJsonStream)

#### 6.1.3 åŸºç¡€ UI

- [ ] ChatView ä¸»ç»„ä»¶
- [ ] ChatHeader ç»„ä»¶
- [ ] ChatMessages ç»„ä»¶
- [ ] ChatInput ç»„ä»¶
- [ ] MessageRenderer ç»„ä»¶
- [ ] åŸºç¡€æ ·å¼ (CSS)

### Phase 2: å®Œæ•´åŠŸèƒ½

**ç›®æ ‡**: å®ç°æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

#### 6.2.1 å¤š Agent æ”¯æŒ

- [ ] Gemini CLI é›†æˆ
- [ ] Codex CLI é›†æˆ
- [ ] Agent åˆ‡æ¢åŠŸèƒ½
- [ ] è‡ªå®šä¹‰ Agent é…ç½®

#### 6.2.2 é«˜çº§æ¶ˆæ¯åŠŸèƒ½

- [ ] å·¥å…·è°ƒç”¨æ¸²æŸ“ (ToolCallRenderer)
- [ ] æƒé™è¯·æ±‚å¤„ç† (PermissionRequestSection)
- [ ] ç»ˆç«¯è¾“å‡ºæ˜¾ç¤º (TerminalRenderer)
- [ ] æ€è€ƒè¿‡ç¨‹æŠ˜å  (CollapsibleThought)
- [ ] è®¡åˆ’æ˜¾ç¤ºç»„ä»¶

#### 6.2.3 ä¸Šä¸‹æ–‡åŠŸèƒ½

- [ ] @mention ç¬”è®°å¼•ç”¨
- [ ] Slash å‘½ä»¤æ”¯æŒ
- [ ] è‡ªåŠ¨å¼•ç”¨æ´»åŠ¨ç¬”è®°
- [ ] ä¸Šä¸‹æ–‡ Badge æ˜¾ç¤º

#### 6.2.4 ä¼šè¯ç®¡ç†

- [ ] ä¼šè¯å¯¼å‡º (Markdown)
- [ ] å†å²ä¼šè¯æµè§ˆ
- [ ] ä¼šè¯æ¢å¤

### Phase 3: ä¼˜åŒ–å’Œå¢å¼º

**ç›®æ ‡**: æå‡ç”¨æˆ·ä½“éªŒå’Œç¨³å®šæ€§

#### 6.3.1 UI/UX ä¼˜åŒ–

- [ ] å“åº”å¼å¸ƒå±€ä¼˜åŒ–
- [ ] åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
- [ ] æš—è‰²/äº®è‰²ä¸»é¢˜é€‚é…
- [ ] å¯è®¿é—®æ€§æ”¹è¿›

#### 6.3.2 æ€§èƒ½ä¼˜åŒ–

- [ ] æ¶ˆæ¯è™šæ‹Ÿåˆ—è¡¨
- [ ] å¤§æ–‡ä»¶ Diff ä¼˜åŒ–
- [ ] å†…å­˜ç®¡ç†

#### 6.3.3 ç¨³å®šæ€§

- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] è¿æ¥æ–­çº¿é‡è¿
- [ ] æ—¥å¿—å’Œè°ƒè¯•å·¥å…·

---

## 7. æŠ€æœ¯çº¦æŸå’Œæ³¨æ„äº‹é¡¹

### 7.1 Obsidian æ’ä»¶è§„èŒƒ

> [!IMPORTANT]
> å¿…é¡»éµå¾ª Obsidian æ’ä»¶å®¡æ ¸è¦æ±‚:

1. **ç¦æ­¢ä½¿ç”¨** `innerHTML` / `outerHTML`ï¼Œä½¿ç”¨ `createEl` / `createDiv` / `createSpan`
2. **ç¦æ­¢åœ¨ onunload ä¸­ detach leaves** (è¿™æ˜¯åæ¨¡å¼)
3. **æ ·å¼å¿…é¡»åœ¨ CSS æ–‡ä»¶ä¸­å®šä¹‰**ï¼Œä¸åœ¨ JS ä¸­æ“ä½œ style
4. **ä½¿ç”¨ Platform æ¥å£**ï¼Œä¸ç›´æ¥ä½¿ç”¨ `process.platform`
5. **æœ€å°åŒ– any ç±»å‹ä½¿ç”¨**ï¼Œæä¾›æ­£ç¡®çš„ç±»å‹å®šä¹‰

### 7.2 ä¾èµ–ç®¡ç†

```json
{
  "dependencies": {
    "@agentclientprotocol/sdk": "^x.x.x",
    "obsidian": "^1.x.x"
  },
  "devDependencies": {
    "react": "^19.x.x",
    "typescript": "^5.x.x",
    "esbuild": "^x.x.x"
  }
}
```

### 7.3 å¹³å°å…¼å®¹æ€§

| å¹³å° | æ”¯æŒæƒ…å†µ | æ³¨æ„äº‹é¡¹ |
|------|----------|----------|
| macOS | âœ… å®Œå…¨æ”¯æŒ | ä½¿ç”¨ `-l` å‚æ•°å¯åŠ¨ login shell |
| Linux | âœ… å®Œå…¨æ”¯æŒ | ä½¿ç”¨ `-l` å‚æ•°å¯åŠ¨ login shell |
| Windows (Native) | âœ… æ”¯æŒ | ä½¿ç”¨ `shell: true` é€‰é¡¹ |
| Windows (WSL) | âœ… æ”¯æŒ | éœ€è¦è·¯å¾„è½¬æ¢å·¥å…· |

---

## 8. éªŒè¯è®¡åˆ’

### 8.1 æ‰‹åŠ¨æµ‹è¯•

#### 8.1.1 Agent è¿æ¥æµ‹è¯•

1. å®‰è£…å¹¶é…ç½® Claude Code ACP
2. åœ¨æ’ä»¶è®¾ç½®ä¸­é…ç½®æ­£ç¡®çš„è·¯å¾„
3. ç‚¹å‡»æ‰“å¼€ Agent Chat
4. éªŒè¯è¿æ¥çŠ¶æ€æ˜¾ç¤ºä¸º "Ready"

#### 8.1.2 æ¶ˆæ¯å‘é€æµ‹è¯•

1. åœ¨ Chat è¾“å…¥æ¡†è¾“å…¥æ¶ˆæ¯
2. æŒ‰ Enter å‘é€
3. éªŒè¯ç”¨æˆ·æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º
4. éªŒè¯ Agent å“åº”æ­£ç¡®æµå¼æ˜¾ç¤º

#### 8.1.3 æƒé™è¯·æ±‚æµ‹è¯•

1. å‘é€ä¸€æ¡è¯·æ±‚ç¼–è¾‘æ–‡ä»¶çš„æ¶ˆæ¯
2. éªŒè¯æƒé™è¯·æ±‚ UI æ­£ç¡®æ˜¾ç¤º
3. ç‚¹å‡» "Allow Once" æŒ‰é’®
4. éªŒè¯æ“ä½œæ­£ç¡®æ‰§è¡Œ

### 8.2 è¾¹ç•Œæ¡ä»¶æµ‹è¯•

- ç½‘ç»œæ–­å¼€æ—¶çš„è¡Œä¸º
- Agent è¿›ç¨‹å¼‚å¸¸é€€å‡ºæ—¶çš„å¤„ç†
- è¶…å¤§æ¶ˆæ¯çš„æ¸²æŸ“æ€§èƒ½
- é•¿æ—¶é—´è¿è¡Œçš„å·¥å…·è°ƒç”¨

---

## 9. é™„å½•

### 9.1 å‚è€ƒèµ„æ–™

- [Agent Client Protocol (ACP) è§„èŒƒ](https://github.com/zed-industries/agent-client-protocol)
- [Obsidian æ’ä»¶å¼€å‘æ–‡æ¡£](https://docs.obsidian.md/Plugins)
- [obsidian-agent-client æºç ](https://github.com/RAIT-09/obsidian-agent-client)
- [obsidian-copilot æºç ](https://github.com/logancyang/obsidian-copilot)

### 9.2 æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| ACP | Agent Client Protocolï¼ŒZed å®šä¹‰çš„ Agent é€šä¿¡åè®® |
| Tool Call | Agent æ‰§è¡Œçš„å·¥å…·è°ƒç”¨æ“ä½œ |
| Permission Request | Agent è¯·æ±‚ç”¨æˆ·æˆæƒæ‰§è¡Œæ•æ„Ÿæ“ä½œ |
| Session | ç”¨æˆ·ä¸ Agent ä¹‹é—´çš„ä¼šè¯å®ä¾‹ |
| Slash Command | ä»¥ `/` å¼€å¤´çš„å¿«æ·å‘½ä»¤ |
| Mention | ä»¥ `@` å¼€å¤´çš„ç¬”è®°å¼•ç”¨ |
